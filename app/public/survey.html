<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Survey Page</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
        crossorigin="anonymous">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <link rel="stylesheet" href="css/surveystyles.css">
    <link href="https://fonts.googleapis.com/css?family=Dosis" rel="stylesheet">

</head>

<body>

    <div class="container">

        <div class="jumbotron jumbotron-fluid">
            <h1 class="text-center"> Wolf Pack Survey</h1>
            <hr>
            <h2 class="text-center">Answer these following questions to find your matching wolf pack!</h2>
            <br>

            <hr>

            <div class="container">

                <form action="">

                    <div class="form-group">
                        <label for="exampleFormControlInput1">Name (required)</label>
                        <input type="text" class="form-control" id="nameInput" required="">
                    </div>

                    
                    <div class="form-group">
                        <label for="exampleFormControlInput1">Link to Image (required)</label>
                        <input type="text" class="form-control" id="imageInput" required="">
                    </div>

                    <p class="questionsText">Generally speaking, you rely more on your experience than your imagination</p>
                    <div class="form-group questions">
                        <select class="form-control" id="question1">
                            <option>Select an answer</option>
                            <option value="1">1 (Strongly Disagree)</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5 (Strongly Agree)</option>
                        </select>
                    </div>

                    <p class="questionsText">Your mind is always buzzing with unexplored ideas and plans</p>
                    <div class="form-group questions">
                        <select class="form-control" id="question2">
                            <option>Select an answer</option>
                            <option value="1">1 (Strongly Disagree)</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5 (Strongly Agree)</option>
                        </select>
                    </div>

                    <p class="questionsText">You find it easy to stay relaxed and focused even when there is some pressure</p>
                    <div class="form-group questions">
                        <select class="form-control" id="question3">
                            <option>Select an answer</option>
                            <option value="1">1 (Strongly Disagree)</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5 (Strongly Agree)</option>
                        </select>
                    </div>

                    <p class="questionsText">You rarely do something just out of sheer curiosity</p>
                    <div class="form-group questions">
                        <select class="form-control" id="question4">
                            <option>Select an answer</option>
                            <option value="1">1 (Strongly Disagree)</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5 (Strongly Agree)</option>
                        </select>
                    </div>

                    <p class="questionsText">People can rarely upset you</p>
                    <div class="form-group questions">
                        <select class="form-control" id="question5">
                            <option>Select an answer</option>
                            <option value="1">1 (Strongly Disagree)</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5 (Strongly Agree)</option>
                        </select>
                    </div>

                    <p class="questionsText">It is often difficult for you to relate to other people’s feelings</p>
                    <div class="form-group questions">
                        <select class="form-control" id="question6">
                            <option>Select an answer</option>
                            <option value="1">1 (Strongly Disagree)</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5 (Strongly Agree)</option>
                        </select>
                    </div>

                    <p class="questionsText">You feel more energetic after spending time with a group of people</p>
                    <div class="form-group questions">
                        <select class="form-control" id="question7">
                            <option>Select an answer</option>
                            <option value="1">1 (Strongly Disagree)</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5 (Strongly Agree)</option>
                        </select>
                    </div>

                    <p class="questionsText">In a discussion, truth should be more important than people’s sensitivities</p>
                    <div class="form-group questions">
                        <select class="form-control" id="question8">
                            <option>Select an answer</option>
                            <option value="1">1 (Strongly Disagree)</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5 (Strongly Agree)</option>
                        </select>
                    </div>

                    <p class="questionsText">You rarely get carried away by fantasies and ideas</p>
                    <div class="form-group questions">
                        <select class="form-control" id="question9">
                            <option>Select an answer</option>
                            <option value="1">1 (Strongly Disagree)</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5 (Strongly Agree)</option>
                        </select>
                    </div>

                    <p class="questionsText">You think that everyone’s views should be respected regardless of whether they are supported by facts or not</p>
                    <div class="form-group questions">
                        <select class="form-control" id="question10">
                            <option>Select an answer</option>
                            <option value="1">1 (Strongly Disagree)</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5 (Strongly Agree)</option>
                        </select>
                    </div>

                    <div class="text-center">
                        <button id="submit" class="btn btn-lg btn-primary"><span class="fa fa-paw"></span> Submit</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <hr>

    <div id="wolf">
        <img id ="wolfimg" src="https://thewallpaper.co/wp-content/uploads/2016/03/abstract-wolf-art-android-wallpapers-cool-artworks-download-images-1805x1128-768x480.jpg" alt="">
    </div>


    <!-- <footer class="footer">
        <div class="container">
            <p><a href="/api/tables">API Table Link</a> | <a href="/api/waitlist">API Wait List</a>
        </div>
    </footer> -->


    <!-- Modal -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLongTitle">Modal title</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    ...
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Save changes</button>
                </div>
            </div>
        </div>
    </div>


    <script>

        $("#submit").on("click", function (event) {

            event.preventDefault();
            
            var formValidation = true;
            
            if ($("#nameInput").val().trim() === "" || $("#imageInput").val().trim() === "") {
                formValidation = false;
            }

            for (let i = 1; i < 10; i++) {
                if ($("#question" + i).val() === "Please select an answer") {
                    formValidation = false;
                }
            }
            
            if (formValidation === true) {
                var user = {
                    "name": $("#nameInput").val().trim(),
                    "image": $("#imageInput").val().trim(),
                    "scores": [
                        $("#question1").val().trim(), 
                        $("#question2").val().trim(), 
                        $("#question3").val().trim(), 
                        $("#question4").val().trim(), 
                        $("#question5").val().trim(), 
                        $("#question6").val().trim(), 
                        $("#question7").val().trim(), 
                        $("#question8").val().trim(), 
                        $("#question9").val().trim(), 
                        $("#question10").val().trim()]
                }

                $.ajax({ 
                    url: "/api/friends", 
                    method: "GET" 
                }).then(function (packData) {
                    
                        var newArray = [];
                        var resultsArray = [];
                   
                        function compareResults(res) {
                            for (let i = 0; i < packData[0].scores.length; i++) {
                                var differenceArray = user.scores[i] - packData[res].scores[i];
                                newArray.push(Math.abs(differenceArray));
                            }

                            function grabSum(total, num) {
                                return total + num;
                            }

                            var sumArray = newArray.reduce(grabSum);
                            resultsArray.push(sumArray)
                            newArray = [];
                        }

                        for (let p = 0; p < packData.length; p++) {
                            compareResults(p);
                        }

                        var lowestResults = Math.min(...resultsArray)
                        var chosenResult = resultsArray.indexOf(lowestResults)

                        $("#packName").text("Your Mathing Pack is: " + packData[chosenResult].name)
                        $("#packImage").html("<img class='resultImage' src='" + packData[chosenResult].image + "' style='width:350px; height:350px;' alt='Matching Pack Picture'>")
                        $("#myModal").modal("show");

                    }).then( () => {
                        var currentURL = window.location.origin;
                        $.post(currentURL + "/api/friends", user, function (data) {
                            $("#nameInput").val("");
                            $("#imageInput").val("");
                        });
                    });
                } else {
                    alert("Fill out all the fields before submitting, otherwise we can't find your matching pack!")
                }
        });
    
    </script>

</body>

</html>